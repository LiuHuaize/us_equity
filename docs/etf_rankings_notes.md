# ETF 排行榜数据质量说明

## 背景

近期生成的 5 年、10 年 ETF 收益榜单中出现了多个“新”基金（如 ESN.US、ORR.US）被拉长为十年区间，导致累计收益与年化收益异常偏高。排查后确认主因是行情供应商将旧标的历史沿用至新基金，数据库 `mart_daily_quotes` 中因此存在远早于基金成立时间的报价记录。

## 数据校验策略

- **交易日覆盖度**：自 2025-11-03 起向前回溯 5 年/10 年窗口，统计实际交易日占日历日的比例。阈值设为 ≥55%，可剔除仅有零星行情的标的。
- **持有期偏差**：现有逻辑允许起始日与窗口起点相差 `fudge_days`（默认 7 天）。若后续需要更严格控制，可在 SQL 层将 `start_date` 与窗口起点的差值记录为 QA 参考。
- **历史拆股过滤**：若窗口内出现 `value < 1` 的拆股事件，默认排除该 ETF，防止异常分母影响收益计算。

## 字段可用性

- `dim_symbol.first_trade_date`：当前对 3,352 只 ETF 全部为空，暂不具备筛选能力。
- `stg_fundamentals.Payload.General.InceptionDate`：供应商返回空字符串，覆盖率同样为 0%。后续若需要按成立日过滤，需从外部清单填充或补做字段映射。

## ETL 建议

1. **补充成立日字段**：优先在 ETL 回填 `first_trade_date` 或 `InceptionDate`，并在 `mart_daily_quotes` 切分历史窗口时参考该时间截断。
2. **交易日覆盖监控**：每日刷新后生成覆盖率分布报告，若某标的低于阈值（如 30%），先剔除后人工核实，避免异常占据排行榜。
3. **成交量活跃度**：可追加要求近一年内交易日数量或成交量为正，以防止停牌或僵尸基金干扰。

## 实施状态

2025-11-05 在 `scripts/etf_rankings.py` 中新增交易日覆盖度过滤，统一阈值 0.55，并重生成 CSV 输出。榜单已剔除 ESN.US、ORR.US 等异常案例。
